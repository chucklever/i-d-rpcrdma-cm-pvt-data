<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>RDMA Connection Manager Private Data For RPC-Over-RDMA Version 1 </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Requirements Language">
<link href="#rfc.section.3" rel="Chapter" title="3 Advertised Transport Properties">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Inline Threshold Size">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Remote Invalidation">
<link href="#rfc.section.4" rel="Chapter" title="4 Private Data Message Format">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Using the R Field">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Send and Receive Size Values">
<link href="#rfc.section.5" rel="Chapter" title="5 Interoperability Considerations">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Interoperability with RPC-over-RDMA Version 1 Implementations">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Interoperability Amongst RDMA Transports">
<link href="#rfc.section.6" rel="Chapter" title="6 Updating the Message Format">
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations">
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Guidance for Designated Experts">
<link href="#rfc.references" rel="Chapter" title="9 References">
<link href="#rfc.references.1" rel="Chapter" title="9.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="9.2 Informative References">
<link href="#rfc.acknowledgments" rel="Chapter">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.45.3 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Lever, C." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-ietf-nfsv4-rpcrdma-cm-pvt-data-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2020-04" />
  <meta name="dct.abstract" content="This document specifies the format of Remote Direct Memory Access - Connection Manager (RDMA-CM) Private Data exchanged between RPC-over-RDMA version 1 peers as part of establishing a connection.  The addition of the private data payload specified in this document is an optional extension that does not alter the RPC-over-RDMA version 1 protocol.  This document updates RFC 8166.   " />
  <meta name="description" content="This document specifies the format of Remote Direct Memory Access - Connection Manager (RDMA-CM) Private Data exchanged between RPC-over-RDMA version 1 peers as part of establishing a connection.  The addition of the private data payload specified in this document is an optional extension that does not alter the RPC-over-RDMA version 1 protocol.  This document updates RFC 8166.   " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network File System Version 4</td>
<td class="right">C. Lever</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Oracle</td>
</tr>
<tr>
<td class="left">Updates: 8166 (if approved)</td>
<td class="right">July 4, 2020</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right"></td>
</tr>
<tr>
<td class="left">Expires: January 5, 2021</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">RDMA Connection Manager Private Data For RPC-Over-RDMA Version 1 <br />
  <span class="filename">draft-ietf-nfsv4-rpcrdma-cm-pvt-data-latest</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document specifies the format of Remote Direct Memory Access - Connection Manager (RDMA-CM) Private Data exchanged between RPC-over-RDMA version 1 peers as part of establishing a connection.  The addition of the private data payload specified in this document is an optional extension that does not alter the RPC-over-RDMA version 1 protocol.  This document updates RFC 8166.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on January 5, 2021.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2020 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Requirements Language</a>
</li>
<li>3.   <a href="#rfc.section.3">Advertised Transport Properties</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Inline Threshold Size</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Remote Invalidation</a>
</li>
</ul><li>4.   <a href="#rfc.section.4">Private Data Message Format</a>
</li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Using the R Field</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Send and Receive Size Values</a>
</li>
</ul><li>5.   <a href="#rfc.section.5">Interoperability Considerations</a>
</li>
<ul><li>5.1.   <a href="#rfc.section.5.1">Interoperability with RPC-over-RDMA Version 1 Implementations</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Interoperability Amongst RDMA Transports</a>
</li>
</ul><li>6.   <a href="#rfc.section.6">Updating the Message Format</a>
</li>
<li>7.   <a href="#rfc.section.7">Security Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a>
</li>
<ul><li>8.1.   <a href="#rfc.section.8.1">Guidance for Designated Experts</a>
</li>
</ul><li>9.   <a href="#rfc.references">References</a>
</li>
<ul><li>9.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>9.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li><a href="#rfc.acknowledgments">Acknowledgments</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#section:A4741DA2-FF86-4A9D-907B-8A73D53C7148" id="section:A4741DA2-FF86-4A9D-907B-8A73D53C7148">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">The RPC-over-RDMA version 1 transport protocol <a href="#RFC8166" class="xref">[RFC8166]</a> enables payload data transfer using Remote Direct Memory Access (RDMA) for upper-layer protocols based on Remote Procedure Calls (RPC) <a href="#RFC5531" class="xref">[RFC5531]</a>.  The terms "Remote Direct Memory Access" (RDMA) and "Direct Data Placement" (DDP) are introduced in <a href="#RFC5040" class="xref">[RFC5040]</a>.  </p>
<p id="rfc.section.1.p.2">The two most immediate shortcomings of RPC-over-RDMA version 1 are: </p>

<ul>
<li>Setting up an RDMA data transfer (via RDMA Read or Write) can be costly.  The small default size of messages transmitted using RDMA Send forces the use of RDMA Read or Write operations even for relatively small messages and data payloads.  <br> The original specification of RPC-over-RDMA version 1 provided an out-of-band protocol for passing inline threshold values between connected peers <a href="#RFC5666" class="xref">[RFC5666]</a>.  However, <a href="#RFC8166" class="xref">[RFC8166]</a> eliminated support for this protocol making it unavailable for this purpose.  </li>
<li>Unlike most other contemporary RDMA-enabled storage protocols, there is no facility in RPC-over-RDMA version 1 that enables the use of remote invalidation <a href="#RFC5042" class="xref">[RFC5042]</a>.  </li>
</ul>

<p> </p>
<p id="rfc.section.1.p.3">Each RPC-over-RDMA version 1 transport header follows the External Data Representation (XDR) <a href="#RFC4506" class="xref">[RFC4506]</a> definition specified in <a href="#RFC8166" class="xref">[RFC8166]</a>.  However, RPC-over-RDMA version 1 has no means of extending this definition in such a way that interoperability with existing implementations is preserved.  As a result, an out-of-band mechanism is needed to help relieve these constraints for existing RPC-over-RDMA version 1 implementations.  </p>
<p id="rfc.section.1.p.4">This document specifies a simple, non-XDR-based message format designed to be passed between RPC-over-RDMA version 1 peers at the time each RDMA transport connection is first established.  The mechanism assumes that the underlying RDMA transport has a private data field that is passed between peers at connection time, such as is present in the iWARP protocol (described in Section 7.1 of <a href="#RFC5044" class="xref">[RFC5044]</a>) or the InfiniBand Connection Manager <a href="#IBA" class="xref">[IBA]</a>.  </p>
<p id="rfc.section.1.p.5">To enable current RPC-over-RDMA version 1 implementations to interoperate with implementations that support the private message format described in this document, implementation of the private data message is OPTIONAL.  When the private data message has been successfully exchanged, peers may choose to perform extended RDMA semantics.  However, the private message format does not alter the XDR definition specified in <a href="#RFC8166" class="xref">[RFC8166]</a>.  </p>
<p id="rfc.section.1.p.6">The message format is intended to be further extensible within the normal scope of such IETF work (see <a href="#section:96A18D5A-2AE4-490D-B140-B964302BF1DF" class="xref">Section 6</a> for further details).  <a href="#section:8701C122-F206-4F87-8FA6-62F1CD648A14" class="xref">Section 8</a> of this document defines an IANA registry for this purpose.  In addition, interoperation between implementations of RPC-over-RDMA version 1 that present this message format to peers and those that do not recognize this message format is guaranteed.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#section:6E4898D3-A2A9-47FA-9CBD-069328E610E4" id="section:6E4898D3-A2A9-47FA-9CBD-069328E610E4">Requirements Language</a>
</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <a href="#RFC2119" class="xref">[RFC2119]</a> <a href="#RFC8174" class="xref">[RFC8174]</a> when, and only when, they appear in all capitals, as shown here.  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#section:D6ED5D4A-E123-4DDD-B65F-733F2B377679" id="section:D6ED5D4A-E123-4DDD-B65F-733F2B377679">Advertised Transport Properties</a>
</h1>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#section:0F60CBDD-8A7E-4B41-B193-18C04201DB3E" id="section:0F60CBDD-8A7E-4B41-B193-18C04201DB3E">Inline Threshold Size</a>
</h1>
<p id="rfc.section.3.1.p.1">Section 3.3.2 of <a href="#RFC8166" class="xref">[RFC8166]</a> defines the term "inline threshold." An inline threshold is the maximum number of bytes that can be transmitted using one RDMA Send and one RDMA Receive.  There are a pair of inline thresholds for a connection: a client-to-server threshold and a server-to-client threshold.  </p>
<p id="rfc.section.3.1.p.2">If an incoming RDMA message exceeds the size of a receiver's inline threshold, the receive operation fails and the RDMA provider typically terminates the connection.  To convey an RPC message larger than the receiver's inline threshold without risking receive failure, a sender must use explicit RDMA data transfer operations, which are more expensive than an RDMA Send.  See Sections 3.3 and 3.5 of <a href="#RFC8166" class="xref">[RFC8166]</a> for a complete discussion.  </p>
<p id="rfc.section.3.1.p.3">The default value of inline thresholds for RPC-over-RDMA version 1 connections is 1024 bytes (as defined in Section 3.3.3 of <a href="#RFC8166" class="xref">[RFC8166]</a>).  This value is adequate for nearly all NFS version 3 procedures.  </p>
<p id="rfc.section.3.1.p.4">NFS version 4 COMPOUND operations <a href="#RFC7530" class="xref">[RFC7530]</a> are larger on average than NFS version 3 procedures <a href="#RFC1813" class="xref">[RFC1813]</a>, forcing clients to use explicit RDMA operations for frequently-issued requests such as LOOKUP and GETATTR.  The use of RPCSEC_GSS security also increases the average size of RPC messages, due to the larger size of RPCSEC_GSS credential material included in RPC headers <a href="#RFC7861" class="xref">[RFC7861]</a>.  </p>
<p id="rfc.section.3.1.p.5">If a sender and receiver could somehow agree on larger inline thresholds, frequently-used RPC transactions avoid the cost of explicit RDMA operations.  </p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#section:F82BDC05-F8A6-478C-A02C-BC308EE75A18" id="section:F82BDC05-F8A6-478C-A02C-BC308EE75A18">Remote Invalidation</a>
</h1>
<p id="rfc.section.3.2.p.1">After an RDMA data transfer operation completes, an RDMA consumer can request that its peer's RDMA network interface card (RNIC) invalidate the Steering Tag (STag) associated with the data transfer <a href="#RFC5042" class="xref">[RFC5042]</a>.  </p>
<p id="rfc.section.3.2.p.2">An RDMA consumer requests remote invalidation by posting an RDMA Send With Invalidate Work Request in place of an RDMA Send Work Request.  Each RDMA Send With Invalidate carries one STag to invalidate.  The receiver of an RDMA Send With Invalidate performs the requested invalidation and then reports that invalidation as part of the completion of a waiting Receive Work Request.  </p>
<p id="rfc.section.3.2.p.3">If both peers support remote invalidation, an RPC-over-RDMA responder might use remote invalidation when replying to an RPC request that provided chunks.  Because one of the chunks has already been invalidated, finalizing the results of the RPC is made simpler and faster.  </p>
<p id="rfc.section.3.2.p.4">However, there are some important caveats which contraindicate the blanket use of remote invalidation: </p>

<ul>
<li>Remote invalidation is not supported by all RNICs.  </li>
<li>Not all RPC-over-RDMA responder implementations can generate RDMA Send With Invalidate Work Requests.  </li>
<li>Not all RPC-over-RDMA requester implementations can recognize when remote invalidation has occurred.  </li>
<li>On one connection in different RPC-over-RDMA transactions, or in a single RPC-over-RDMA transaction, an RPC-over-RDMA requester can expose a mixture of STags that may be invalidated remotely and some that must not be.  No indication is provided at the RDMA layer as to which is which.  </li>
</ul>

<p> A responder therefore must not employ remote invalidation unless it is aware of support for it in its own RDMA stack, and on the requester.  And, without altering the XDR structure of RPC-over-RDMA version 1 messages, it is not possible to support remote invalidation with requesters that mix STags that may and must not be invalidated remotely in a single RPC or on the same connection.  </p>
<p id="rfc.section.3.2.p.5">There are some NFS/RDMA client implementations whose STags are always safe to invalidate remotely.  For such clients, indicating to the responder that remote invalidation is always safe can enable such invalidation without the need for additional protocol elements to be defined.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#section:99541DF3-E579-42B6-9C7A-D020926798F6" id="section:99541DF3-E579-42B6-9C7A-D020926798F6">Private Data Message Format</a>
</h1>
<p id="rfc.section.4.p.1">With an InfiniBand lower layer, for example, RDMA connection setup uses a Connection Manager when establishing a Reliable Connection <a href="#IBA" class="xref">[IBA]</a>.  When an RPC-over-RDMA version 1 transport connection is established, the client (which actively establishes connections) and the server (which passively accepts connections) populate the CM Private Data field exchanged as part of CM connection establishment.  </p>
<p id="rfc.section.4.p.2">The transport properties exchanged via this mechanism are fixed for the life of the connection.  Each new connection presents an opportunity for a fresh exchange.  An implementation of the extension described in this document MUST be prepared for the settings to change upon a reconnection.  </p>
<p id="rfc.section.4.p.3">For RPC-over-RDMA version 1, the CM Private Data field is formatted as described in the following subsection.  RPC clients and servers use the same format.  If the capacity of the Private Data field is too small to contain this message format or the underlying RDMA transport is not managed by a Connection Manager, the CM Private Data field cannot be used on behalf of RPC-over-RDMA version 1.  </p>
<p id="rfc.section.4.p.4">The first 8 octets of the CM Private Data field is to be formatted as follows: </p>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Format Identifier                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Version    |  Reserved   |R|   Send Size   | Receive Size  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p></p>

<dl>
<dt>Format Identifier:</dt>
<dd style="margin-left: 8">This field contains a fixed 32-bit value that identifies the content of the Private Data field as an RPC-over-RDMA version 1 CM Private Data message.  In RPC-over-RDMA version 1 Private Data, the value of this field is always 0xf6ab0e18, in network byte order.  The use of this field is further expanded upon in <a href="#section:0BD80E15-13FF-4210-A1D8-E0AE531821A4" class="xref">Section 5.2</a>.  </dd>
<dt>Version:</dt>
<dd style="margin-left: 8">This 8-bit field contains a message format version number.  The value "1" in this field indicates that exactly eight octets are present, that they appear in the order described in this section, and that each has the meaning defined in this section.  Further considerations about the use of this field are discussed in <a href="#section:96A18D5A-2AE4-490D-B140-B964302BF1DF" class="xref">Section 6</a>.  </dd>
<dt>Reserved:</dt>
<dd style="margin-left: 8">This 7-bit field is unused.  Senders MUST set these bits to zero and receivers MUST ignore their value.  </dd>
<dt>R:</dt>
<dd style="margin-left: 8">This 1-bit field indicates that the sender supports remote invalidation.  The field is set and interpreted as described in <a href="#section:1D624044-49CC-4464-9BEF-59EA2473ACBF" class="xref">Section 4.1</a>.  </dd>
<dt>Send Size:</dt>
<dd style="margin-left: 8">This 8-bit field contains an encoded value corresponding to the maximum number of bytes this peer is prepared to transmit in a single RDMA Send on this connection.  The value is encoded as described in <a href="#section:689BD9D4-9C3C-41C7-81F3-8BBE283D252B" class="xref">Section 4.2</a>.  </dd>
<dt>Receive Size:</dt>
<dd style="margin-left: 8">This 8-bit field contains an encoded value corresponding to the maximum number of bytes this peer is prepared to receive with a single RDMA Receive on this connection.  The value is encoded as described in <a href="#section:689BD9D4-9C3C-41C7-81F3-8BBE283D252B" class="xref">Section 4.2</a>.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#section:1D624044-49CC-4464-9BEF-59EA2473ACBF" id="section:1D624044-49CC-4464-9BEF-59EA2473ACBF">Using the R Field</a>
</h1>
<p id="rfc.section.4.1.p.1">The R field indicates limited support for remote invalidate as described in <a href="#section:F82BDC05-F8A6-478C-A02C-BC308EE75A18" class="xref">Section 3.2</a>.  When both connection peers have set this bit flag in their CM Private Data, the responder MAY use RDMA Send With Invalidate when transmitting RPC Replies.  Each RDMA Send With Invalidate MUST invalidate an STag associated only with the XID in the rdma_xid field of the RPC-over-RDMA Transport Header it carries.  </p>
<p id="rfc.section.4.1.p.2">When either peer on a connection clears this flag, the responder MUST use only RDMA Send when transmitting RPC Replies.  </p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#section:689BD9D4-9C3C-41C7-81F3-8BBE283D252B" id="section:689BD9D4-9C3C-41C7-81F3-8BBE283D252B">Send and Receive Size Values</a>
</h1>
<p id="rfc.section.4.2.p.1">Inline threshold sizes from 1024 to 262144 octets can be represented in the Send Size and Receive Size fields.  The inline threshold values provide a pair of 1024-octet-aligned maximum message lengths that guarantee Send and Receive operations do not fail due to length errors.  </p>
<p id="rfc.section.4.2.p.2">The minimum inline threshold for RPC-over-RDMA version 1 is 1024 octets (see Section 3.3.3 of <a href="#RFC8166" class="xref">[RFC8166]</a>).  The values in the Send Size and Receive Size fields represent the unsigned number of additional kilo-octets of length beyond the first 1024 octets.  Thus, a sender computes the encoded value by dividing its actual buffer size, in octets, by 1024 and subtracting one from the result.  A receiver decodes an incoming Size value by performing the inverse set of operations: it adds one to the encoded value and then multiplies that result by 1024.  </p>
<p id="rfc.section.4.2.p.3">The client uses the smaller of its own send size and the server's reported receive size as the client-to-server inline threshold.  The server uses the smaller of its own send size and the clients's reported receive size as the server-to-client inline threshold.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#section:58229D50-C3E7-48D1-A82F-7720AC8A9F8B" id="section:58229D50-C3E7-48D1-A82F-7720AC8A9F8B">Interoperability Considerations</a>
</h1>
<p id="rfc.section.5.p.1">The extension described in this document is designed to allow RPC-over-RDMA version implementations that use CM Private Data to interoperate fully with RPC-over-RDMA version 1 implementations that do not exchange this information.  Implementations that use this extension must also interoperate fully with RDMA implementations that use CM Private Data for other purposes.  Realizing these goals requires that implementations of this extension follow the practices described in the rest of this section.  </p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#section:9A3B285D-D557-4028-ACB0-60EA1C9C93BE" id="section:9A3B285D-D557-4028-ACB0-60EA1C9C93BE">Interoperability with RPC-over-RDMA Version 1 Implementations</a>
</h1>
<p id="rfc.section.5.1.p.1">When a peer does not receive a CM Private Data message which conforms to <a href="#section:99541DF3-E579-42B6-9C7A-D020926798F6" class="xref">Section 4</a>, it needs to act as if the remote peer supports only the default RPC-over-RDMA version 1 settings, as defined in <a href="#RFC8166" class="xref">[RFC8166]</a>.  In other words, the peer MUST behave as if a Private Data message was received in which bit 15 of the Flags field is zero, and both Size fields contain the value zero.  </p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> <a href="#section:0BD80E15-13FF-4210-A1D8-E0AE531821A4" id="section:0BD80E15-13FF-4210-A1D8-E0AE531821A4">Interoperability Amongst RDMA Transports</a>
</h1>
<p id="rfc.section.5.2.p.1">The Format Identifier field defined in <a href="#section:99541DF3-E579-42B6-9C7A-D020926798F6" class="xref">Section 4</a> is provided to enable implementations to distinguish RPC-over-RDMA version 1 Private Data from private data inserted at other layers, such as the private data inserted by the iWARP MPAv2 enhancement described in <a href="#RFC6581" class="xref">[RFC6581]</a>.  </p>
<p id="rfc.section.5.2.p.2">As part of connection establishment, the received private data buffer is searched for the Format Identifier word.  The offset of the Format Identifier is not restricted to any alignment.  If the RPC-over-RDMA version 1 CM Private Data Format Identifier is not present, an RPC-over-RDMA version 1 receiver MUST behave as if no RPC-over-RDMA version 1 CM Private Data has been provided.  </p>
<p id="rfc.section.5.2.p.3">Once the RPC-over-RDMA version 1 CM Private Data Format Identifier is found, the receiver parses the subsequent octets as RPC-over-RDMA version 1 CM Private Data.  As additional assurance that the private data content is valid RPC-over-RDMA version 1 CM Private Data, the receiver should check that the format version number field contains a valid and recognized version number and the size of the private data does not overrun the length of the buffer.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#section:96A18D5A-2AE4-490D-B140-B964302BF1DF" id="section:96A18D5A-2AE4-490D-B140-B964302BF1DF">Updating the Message Format</a>
</h1>
<p id="rfc.section.6.p.1">Although the message format described in this document provides the ability for the client and server to exchange particular information about the local RPC-over-RDMA implementation, it is possible that there will be a future need to exchange additional properties.  This would make it necessary to extend or otherwise modify the format described in this document.  </p>
<p id="rfc.section.6.p.2">Any modification faces the problem of interoperating properly with implementations of RPC-over-RDMA version 1 that are unaware of the existence of the new format.  These include implementations that that do not recognize the exchange of CM Private Data as well as those that recognize only the format described in this document.  </p>
<p id="rfc.section.6.p.3">Given the message format described in this document, these interoperability constraints could be met by the following sorts of new message formats: </p>

<ul>
<li>A format which uses a different value for the first four bytes of the format, as provided for in the registry described in <a href="#section:8701C122-F206-4F87-8FA6-62F1CD648A14" class="xref">Section 8</a>.  </li>
<li>A format which uses the same value for the Format Identifier field and a value other than one (1) in the Version field.  </li>
</ul>

<p> Although it is possible to reorganize the last three of the eight bytes in the existing format, extended formats are unlikely to do so.  New formats would take the form of extensions of the format described in this document with added fields starting at byte eight of the format or changes to the definition of bits in the Reserved field.  </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#section:19F962AD-CDE5-4216-BE3A-44BD238458EC" id="section:19F962AD-CDE5-4216-BE3A-44BD238458EC">Security Considerations</a>
</h1>
<p id="rfc.section.7.p.1">The reader is directed to the Security Considerations section of <a href="#RFC8166" class="xref">[RFC8166]</a> for background and further discussion.  </p>
<p id="rfc.section.7.p.2">The integrity of CM Private Data and the authenticity of its source are ensured by the exclusive use of reliable queue pairs.  iWARP queue pairs have neither a datagram nor an unreliable mode, therefore they are always reliable connections <a href="#RFC5040" class="xref">[RFC5040]</a>.  On InfiniBand and RoCE, the RPC-over-RDMA version 1 protocol framework depends on the semantics of the Reliable Connected (RC) queue pair (QP) type, as defined in Section 9.7.7 of <a href="#IBA" class="xref">[IBA]</a>.  Any attempt to interfere with or hijack data in transit on an RC connection results in the RDMA provider terminating the connection.  </p>
<p id="rfc.section.7.p.3">The Security Considerations section of <a href="#RFC5042" class="xref">[RFC5042]</a> refers the reader to further relevant discussion of generic RDMA transport security.  That document recommends IPsec as the default transport layer security solution.  When deployed with iWARP, IPsec establishes a protected channel before any iWARP operations are exchanged, thus it protects the exchange of Private Data that occurs as each QP is established.  However, IPsec is not available for InfiniBand or RoCE deployments.  Those fabrics rely on physical security and cyclic redundancy checks to protect network traffic.  </p>
<p id="rfc.section.7.p.4">Exchanging the information contained in the Private Message format defined in this document does not expose upper-layer payloads to an attacker.  Furthermore, the behavior changes that occur as a result of processing the CM Private Data format described in the current document do not introduce any new risk of exposure of upper-layer payload data.  </p>
<p id="rfc.section.7.p.5">Improperly setting one of the fields in a version 1 Private Message can result in an increased risk of disconnection (i.e., self-imposed Denial of Service).  A similar risk can arise if non-RPC-over-RDMA CM Private Data inadvertently contains the Format Identifier that identifies this protocol's data structure.  Additional checking of incoming Private Data, as described in <a href="#section:0BD80E15-13FF-4210-A1D8-E0AE531821A4" class="xref">Section 5.2</a>, can help reduce this risk.  </p>
<p id="rfc.section.7.p.6">In addition to describing the structure of a new format version, any document that extends the Private Data format described in the current document must discuss security considerations of new data items exchanged between connection peers.  Such documents should also explore the risks of erroneously identifying non-RPC-over-RDMA CM Private Data as the new format.  </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#section:8701C122-F206-4F87-8FA6-62F1CD648A14" id="section:8701C122-F206-4F87-8FA6-62F1CD648A14">IANA Considerations</a>
</h1>
<p id="rfc.section.8.p.1">In accordance with <a href="#RFC8126" class="xref">[RFC8126]</a>, the author requests that IANA create a new registry in the "Remote Direct Data Placement" Protocol Category Group.  The new registry is to be called the "RDMA-CM Private Data Identifier Registry".  This is a registry of 32-bit numbers that identify the upper-layer protocol associated with data that appears in the application-specific RDMA-CM Private Data area.  The fields in this registry include: Format Identifier, Format Length (in octets), Description, and Reference.  </p>
<p id="rfc.section.8.p.2">The initial contents of this registry are a single entry: </p>
<div id="rfc.table.1"></div>
<div id="table:336556D8-B52A-476E-8E9E-FDF4A4C7ED66"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<caption>RDMA-CM Private Data Identifier Registry</caption>
<thead><tr>
<th class="left">Format Identifier</th>
<th class="left">Length</th>
<th class="left">Description</th>
<th class="left">Reference</th>
</tr></thead>
<tbody><tr>
<td class="left">0xf6ab0e18</td>
<td class="left">8</td>
<td class="left">RPC-over-RDMA version 1 CM Private Data</td>
<td class="left">[RFC-TBD]</td>
</tr></tbody>
</table>
<p id="rfc.section.8.p.3">IANA is to assign subsequent new entries in this registry using the Specification Required policy as defined in Section 4.6 of <a href="#RFC8126" class="xref">[RFC8126]</a>.  </p>
<h1 id="rfc.section.8.1">
<a href="#rfc.section.8.1">8.1.</a> <a href="#section:DB1C2628-A2D2-4EE7-8CD6-592F832C8C86" id="section:DB1C2628-A2D2-4EE7-8CD6-592F832C8C86">Guidance for Designated Experts</a>
</h1>
<p id="rfc.section.8.1.p.1">The Designated Expert (DE), appointed by the IESG, should ascertain the existence of suitable documentation that defines the semantics and format of the private data, and verify that the document is permanently and publicly available.  Documentation produced outside the IETF must not conflict with work that is active or already published within the IETF.  The new Reference field should contain a reference to that documentation.  </p>
<p id="rfc.section.8.1.p.2">The Description field should contain the name of the upper-layer protocol that generates and uses the private data.  </p>
<p id="rfc.section.8.1.p.3">The DE should assign a new Format Identifier so that it does not conflict with existing entries in this registry, and so that it is not likely to be mistaken as part of the payload of other registered formats.  </p>
<p id="rfc.section.8.1.p.4">The DE shall post the request to the nfsv4 WG mailing list (or a successor to that list, if such a list exists), for comment and review.  The DE shall approve or deny the request and publish notice of the decision within 30 days.  </p>
<h1 id="rfc.references">
<a href="#rfc.references">9.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">9.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4506">[RFC4506]</b></td>
<td class="top">
<a>Eisler, M.</a>, "<a href="https://tools.ietf.org/html/rfc4506">XDR: External Data Representation Standard</a>", STD 67, RFC 4506, DOI 10.17487/RFC4506, May 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5040">[RFC5040]</b></td>
<td class="top">
<a>Recio, R.</a>, <a>Metzler, B.</a>, <a>Culley, P.</a>, <a>Hilland, J.</a> and <a>D. Garcia</a>, "<a href="https://tools.ietf.org/html/rfc5040">A Remote Direct Memory Access Protocol Specification</a>", RFC 5040, DOI 10.17487/RFC5040, October 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5042">[RFC5042]</b></td>
<td class="top">
<a>Pinkerton, J.</a> and <a>E. Deleganes</a>, "<a href="https://tools.ietf.org/html/rfc5042">Direct Data Placement Protocol (DDP) / Remote Direct Memory Access Protocol (RDMAP) Security</a>", RFC 5042, DOI 10.17487/RFC5042, October 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8126">[RFC8126]</b></td>
<td class="top">
<a>Cotton, M.</a>, <a>Leiba, B.</a> and <a>T. Narten</a>, "<a href="https://tools.ietf.org/html/rfc8126">Guidelines for Writing an IANA Considerations Section in RFCs</a>", BCP 26, RFC 8126, DOI 10.17487/RFC8126, June 2017.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8166">[RFC8166]</b></td>
<td class="top">
<a>Lever, C.</a>, <a>Simpson, W.</a> and <a>T. Talpey</a>, "<a href="https://tools.ietf.org/html/rfc8166">Remote Direct Memory Access Transport for Remote Procedure Call Version 1</a>", RFC 8166, DOI 10.17487/RFC8166, June 2017.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8174">[RFC8174]</b></td>
<td class="top">
<a>Leiba, B.</a>, "<a href="https://tools.ietf.org/html/rfc8174">Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</a>", BCP 14, RFC 8174, DOI 10.17487/RFC8174, May 2017.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">9.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="IBA">[IBA]</b></td>
<td class="top">
<a>InfiniBand Trade Association</a>, "<a>InfiniBand Architecture Specification Volume 1</a>", Release 1.3, March 2015.<p>Available from https://www.infinibandta.org/ </p>
</td>
</tr>
<tr>
<td class="reference"><b id="RFC1813">[RFC1813]</b></td>
<td class="top">
<a>Callaghan, B.</a>, <a>Pawlowski, B.</a> and <a>P. Staubach</a>, "<a href="https://tools.ietf.org/html/rfc1813">NFS Version 3 Protocol Specification</a>", RFC 1813, DOI 10.17487/RFC1813, June 1995.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5044">[RFC5044]</b></td>
<td class="top">
<a>Culley, P.</a>, <a>Elzur, U.</a>, <a>Recio, R.</a>, <a>Bailey, S.</a> and <a>J. Carrier</a>, "<a href="https://tools.ietf.org/html/rfc5044">Marker PDU Aligned Framing for TCP Specification</a>", RFC 5044, DOI 10.17487/RFC5044, October 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5531">[RFC5531]</b></td>
<td class="top">
<a>Thurlow, R.</a>, "<a href="https://tools.ietf.org/html/rfc5531">RPC: Remote Procedure Call Protocol Specification Version 2</a>", RFC 5531, DOI 10.17487/RFC5531, May 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5666">[RFC5666]</b></td>
<td class="top">
<a>Talpey, T.</a> and <a>B. Callaghan</a>, "<a href="https://tools.ietf.org/html/rfc5666">Remote Direct Memory Access Transport for Remote Procedure Call</a>", RFC 5666, DOI 10.17487/RFC5666, January 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6581">[RFC6581]</b></td>
<td class="top">
<a>Kanevsky, A.</a>, <a>Bestler, C.</a>, <a>Sharp, R.</a> and <a>S. Wise</a>, "<a href="https://tools.ietf.org/html/rfc6581">Enhanced Remote Direct Memory Access (RDMA) Connection Establishment</a>", RFC 6581, DOI 10.17487/RFC6581, April 2012.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7530">[RFC7530]</b></td>
<td class="top">
<a>Haynes, T.</a> and <a>D. Noveck</a>, "<a href="https://tools.ietf.org/html/rfc7530">Network File System (NFS) Version 4 Protocol</a>", RFC 7530, DOI 10.17487/RFC7530, March 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7861">[RFC7861]</b></td>
<td class="top">
<a>Adamson, A.</a> and <a>N. Williams</a>, "<a href="https://tools.ietf.org/html/rfc7861">Remote Procedure Call (RPC) Security Version 3</a>", RFC 7861, DOI 10.17487/RFC7861, November 2016.</td>
</tr>
</tbody></table>
<h1 id="rfc.acknowledgments"><a href="#rfc.acknowledgments">Acknowledgments</a></h1>
<p id="rfc.section.A.p.1">Thanks to Christoph Hellwig and Devesh Sharma for suggesting this approach, and to Tom Talpey and Dave Noveck for their expert comments and review.  The author also wishes to thank Bill Baker and Greg Marsden for their support of this work.  Also, thanks to expert reviewers Sean Hefty and Dave Minturn.  </p>
<p id="rfc.section.A.p.2">Special thanks go to document shepherd Brian Pawlowski, Transport Area Director Magnus Westerlund, NFSV4 Working Group Chairs David Noveck and Spencer Shepler, and NFSV4 Working Group Secretary Thomas Haynes.  </p>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Charles Lever</span> 
	  <span class="n hidden">
		<span class="family-name">Lever</span>
	  </span>
	</span>
	<span class="org vcardline">Oracle Corporation</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">United States of America</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:chuck.lever@oracle.com">chuck.lever@oracle.com</a></span>

  </address>
</div>

</body>
</html>
